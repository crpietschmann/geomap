
ï»¿
(function($g){var g=$g.Providers.Google=function(elem,opts){return new g.fn.init($(elem),opts);};g.Default={};g.fn=g.prototype={version:'0.2.0',init:function(elem,opts){var that=this,map=null,i=null,center=geomap.parseLocation(elem,"center"),mapOptions={center:new google.maps.LatLng((center!==null?center.latitude:0),(center!==null?center.longitude:0)),zoom:(elem.attr("zoom")!==undefined)?parseFloat(elem.attr("zoom")):1,mapTypeId:google.maps.MapTypeId.ROADMAP},shapes=[];elem.find('pushpin').each(function(){var loc=geomap.parseLocation(this),marker=new google.maps.Marker({position:new google.maps.LatLng(loc.latitude,loc.longitude),icon:$(this).attr('icon')});shapes.push(marker);if($(this).find('info').length>0){var info=geomap.parseInfo($(this).find('info')),infoTitle=(info.title)?"<h1>"+info.title+"</h1>":"",infoHtml="<span class='geomap-info'>"+infoTitle+info.content+"</span>",infoWindow=new google.maps.InfoWindow({position:marker.getPosition(),content:infoHtml});marker.setTitle(info.title);var hideListenerHooked=false;google.maps.event.addListener(marker,'click',function(){infoWindow.open(marker.getMap(),marker);if(!hideListenerHooked){google.maps.event.addListener(marker.getMap(),'drag',function(){infoWindow.close();});hideListenerHooked=true;}});}});elem.find('polyline').each(function(){var locs=[];$(this).find("location").each(function(){var loc=geomap.parseLocation(this);locs.push(new google.maps.LatLng(loc.latitude,loc.longitude));});shapes.push(new google.maps.Polyline({path:locs}));});elem.find('polygon').each(function(){var locs=[];$(this).find("location").each(function(){var loc=geomap.parseLocation(this);locs.push(new google.maps.LatLng(loc.latitude,loc.longitude));});shapes.push(new google.maps.Polygon({path:locs}));});map=new google.maps.Map(elem[0],mapOptions);this.providerMap(map);for(var i in shapes){shapes[i].setMap(map);}},providerMap:function(v){if(v){this._providerMap=v;return this;}
return this._providerMap;}};g.fn.init.prototype=g.fn;if(!$g.Providers.Default.provider){$g.Providers.Default.provider='google';}})(window.geomap);